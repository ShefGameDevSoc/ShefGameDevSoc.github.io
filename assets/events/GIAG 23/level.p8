pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- mario 2
-- by will

playerx = 20
playery = 0
playerframe = 0

function _init()
	--when program starts
end

--check collision
function solid(x, y)
	-- grab the cel value
	--majic numbers
	val=mget(((x+4)/8), ((y+4)/8))
	
	--check if its a coin
	if (fget(val,0)) then
		--play sound
		sfx(0)
		--set tile to 0
		mset(((x+4)/8), ((y+4)/8), 0)
	end
	
	--check if this is a wall
	return fget(val, 1)
end

-- check if the player is colliding		
function player_collides_wall()
 return solid_area(playerx,playery,1,1)
end

--check collision bounds
function solid_area(x,y,w,h, typ)
	return 
		solid(x-w,y-h) or
		solid(x+w,y-h) or
		solid(x-w,y+h) or
		solid(x+w,y+h)
end

function try_move(x,y)
	playerx += x
	playery += y
	if (player_collides_wall()) then
		playerx -= x
		playery -= y
		return false
	end
	return true
end

function is_allowed_jump()
	playery += 1
	local result = player_collides_wall()
	playery -= 1
	return result
end

function _update()
	player_speed = 3
	playerframe = 0
	
	--moving things around
	if(btn(1)) then  
  if (try_move(player_speed,0)) then
  	playerframe = 2	
  end
 end
 
 --moving things around
	if(btn(0)) then
 	if (try_move(-1 * player_speed,0)) then
  	playerframe = 2	
  end
 end
 
 --control jumping
 jump_height = 20
 if (btnp(4) and is_allowed_jump()) then
 	--check how high we can jump
  for c=1,jump_height do
   try_move(0,-1)
  end
 end
 
 fall_speed = 1
 try_move(0,fall_speed)
end

function _draw()
	cls(12)
	map()
	
	camera(playerx-30,0)
	
	--drawing things to screen
	spr(playerframe+get_frame(2),playerx,playery-2)
end

--animation
function get_frame(no_frames)
	return (time()*5)%no_frames
end
__gfx__
77700777000007777770077777700777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7e7007e7777007e77e7007e77e7007e7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7e7777e77e7777e77e7777e77e7777e7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77707077777070777770707777707077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07770770077707700777077007770770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007777000077770000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007777000077770000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700007007000070700000070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb0aaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44b444bb0a9999a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444848440a9aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
484444440a9aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444448440a9999a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
484444440aaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444448000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
48444844000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44484448000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00aaa000000000000077700000000000099aa9900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00a9a000000700000077770000000000a999999a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00aaa000077777700777770077770000a999999a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33030000077667777766777777770000a099990a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
030303330777667767677777667700000aa99aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333300077776766677776667770000000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0033300007767776777666777677000000a99a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0033300000777777777777777770000000aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000002010000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000000000000000000000000000000000000000000000004040000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000000000000000000000000000000000000003132330400000400000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000313233000000000000000031323300000000000000000000040400040400000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000000000000000000000000000000000000040400040000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000000000000000000000000000000000000000404040000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000110000300000111100003000000011000000110000001100000404001111003000111100003420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2010101010101010101010101000000010000000100000001000000010101010101010101010101020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202010000000000000000000000000000020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020100000000030000000003000000020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020201010101010101010101010101020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100001d1501f1501f1501e1501c150211500000000000000000000000000000000000000000000000000000000000002810000000000000000000000000000000000000000000000000000000000000000000
